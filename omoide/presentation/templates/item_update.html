{% extends "base_search.html" %}
{% from "macros.html" import render_thumbnail_for_item %}

{% block head %}
    <script type="text/javascript"
            src="{{ url_for('static', path='crud.js') }}"></script>
    <script type="text/javascript"
            src="{{ url_for('static', path='item_update.js') }}"></script>
    <link type="text/css"
          href="{{ url_for('static', path='crud.css') }}"
          rel="stylesheet">
{% endblock %}

{% block body %}
    <div class="narrow-block">
        <h1>Item edit</h1>

        <div id="thumbnail" class="thumbnail"></div>

        <p>Target item: <strong>{{ item.name or item.uuid }}</strong>
            <br>Owner of the item: <strong>{{ user.name }}</strong></p>

        <div id="alerts"></div>

        <div>
            <h3>Basic parameters</h3>
            <label for="item_name">Name<br>
                <input id="item_name"
                       type="text"
                       value="{{ item.name }}"
                       onchange="alterModelTextField(this, 'name')"
                       class="height-auto">
            </label>

            <div>
                <input type="checkbox"
                        {{ 'checked' if item.is_collection else '' }}
                       onchange="alterModelBoolField(this, 'is_collection')"
                       id="item_is_collection">
                <label for="item_is_collection">Item is collection</label>
            </div>

            <label for="item_content_ext">Content extension<br>
                <input id="item_content_ext"
                       type="text"
                       value="{{ item.content_ext }}"
                       onchange="alterModelTextField(this, 'content_ext')"
                       class="height-auto">
            </label>

            <label for="item_preview_ext">Preview extension<br>
                <input id="item_preview_ext"
                       type="text"
                       value="{{ item.preview_ext }}"
                       onchange="alterModelTextField(this, 'preview_ext')"
                       class="height-auto">
            </label>

            <label for="item_thumbnail_ext">Thumbnail extension<br>
                <input id="item_thumbnail_ext"
                       type="text"
                       value="{{ item.thumbnail_ext }}"
                       onchange="alterModelTextField(this, 'thumbnail_ext')"
                       class="height-auto">
            </label>

            <input id="save_basic"
                   type="button"
                   class="button control-button button-disabled"
                   disabled
                   onclick="saveBasic()"
                   value="Save basic parameters">

            <input id="reset_basic"
                   type="button"
                   class="button control-button"
                   onclick="resetBasic()"
                   value="Reset changes">
        </div>

        <div>
            <h3>Tags fot the item and dependant items</h3>
            <label for="item_tags">Tags (one tag per line):<br>
                <textarea id="item_tags"
                          onchange="alterModelTagsField(this)"
                          rows="7">
                {%- for tag in item.tags -%}{{ tag + '\n' }}{% endfor -%}
            </textarea>
            </label>

            <input id="save_tags"
                   type="button"
                   class="button control-button button-disabled"
                   disabled
                   onclick="saveTags('{{ total }}')"
                   value="Save tags">

            <input id="reset_tags"
                   type="button"
                   class="button control-button"
                   onclick="resetTags()"
                   value="Reset changes">
        </div>

        <div>
            <h3>Users who can see this item</h3>
            <label for="item_permissions">Permissions (one user per line):<br>
                <textarea id="item_permissions"
                          onchange="alterModelPermissionsField(this)"
                          rows="5">
                {%- for user in permissions -%}
                    {{ user.uuid|string }} {{ user.name + '\n' }}{% endfor -%}
            </textarea>
            </label>

            <div>
                <input type="checkbox"
                       checked
                       id="item_perm_apply_to_parents">
                <label for="item_perm_apply_to_parents">Also apply to all
                    parent items</label>
            </div>

            <div>
                <input type="checkbox"
                       id="item_perm_apply_to_children">
                <label for="item_perm_apply_to_children">Also apply to all
                    child items</label>
            </div>

            <input id="save_permissions"
                   type="button"
                   class="button control-button button-disabled"
                   disabled
                   onclick="savePermissions('{{ total }}')"
                   value="Save permissions">

            <input id="reset_permissions"
                   type="button"
                   class="button control-button"
                   onclick="resetPermissions()"
                   value="Reset changes">
        </div>

    </div>

    <script>
        let oldModel = {{ model | safe }};
        let newModel = {{ model | safe }};
        let initialPermissions = {{ initial_permissions | safe }};

        $(document).ready(function () {
            tryLoadingThumbnail('{{ item.uuid }}', $('#thumbnail'))
        });
    </script>

    <br>
    <br>

{% endblock %}
